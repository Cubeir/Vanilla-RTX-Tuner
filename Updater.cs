/* Previous implementation was a train wreck, rewrite here later */